!function t(e,i,n){function o(s,d){if(!i[s]){if(!e[s]){var a="function"==typeof require&&require;if(!d&&a)return a(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=i[s]={exports:{}};e[s][0].call(c.exports,function(t){var i=e[s][1][t];return o(i||t)},c,c.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){var n=window.Drupal,o=window.jQuery;n.behaviors.paragraphs_editor_bundleselector={attach:function(t){o(".paragraphs-editor-bundle-selector-search",t).each(function(){var t=o(this),e=t.find(".paragraphs-editor-bundle-selector-search__input"),i=t.find(".paragraphs-editor-bundle-selector-search__submit");e.keyup(function(t){i.mousedown()}).blur(function(){o(this).trigger("focus")})})}}},{}],2:[function(t,e,i){var n=window.Drupal;t("widget-binder");e.exports=SyncProtocol.extend({send:function(t,e,i,n){"FETCH_SCHEMA"==t?this._get(e,n):this._sendAjaxCommand(e,i,n)},_sendAjaxCommand:function(t,e,i){if(t.command){var o="/ajax/paragraphs-editor/"+t.command;"targetContext"in t&&(o+="/"+t.targetContext),"sourceContext"in t&&(o+="/"+t.sourceContext),"paragraph"in t&&(o+="/"+t.paragraph),"widget"in t&&(o+="/"+t.widget),"bundleName"in t&&(o+="/"+t.bundleName);var r=[];for(var s in e)r.push("settings["+s+"]="+e[s]);o+="?"+r.join("&");var d=n.ajax({url:o,progress:{message:""}});d.options.data.editorContext=this._editorContext.get("id"),t.edits&&(d.options.data.nested_contexts=_.keys(t.edits));var a=d.options.complete;d.options.complete=function(t,e){a.call(d.options,t,e),n.ajax.instances.splice(d.instanceIndex,1)},d.execute()}},_get:function(t,e){$.get("/ajax/paragraphs-editor/schema/"+t,"",function(t){e.resolve(t)})}})},{"widget-binder":36}],3:[function(t,e,i){var n=window.Drupal,o=(window.drupalSettings,window.jQuery),r=t("./WidgetBindingProtocol");WidgetBinder=t("widget-binder"),t("./BundleSelector"),n.paragraphs_editor={},n.AjaxCommands.prototype.paragraphs_editor_data=function(t,e,i){o.fn.paragraphsEditor.widgetBinder.getSyncActionResolver().resolve(e)},n.theme.paragraphsEditorWidget=function(t,e){return WidgetBinder.defaults.views.editor.options.template(t,e)},n.theme.paragraphsEditorExport=function(t,e,i){return WidgetBinder.defaults.views.export.options.template(t,e,i)},n.paragraphs_editor.register=function(t,e){var i=_.extend({},WidgetBinder.defaults);return i.plugins={adapter:e,protocol:new r},i.elements.widget={tag:"paragraph",attributes:{"data-uuid":"<uuid>","data-context-hint":"<context>","data-viewmode":"<viewmode>"}},i.elements.field={tag:"paragraph-field",attributes:{"data-field-name":"<field>","data-context":"<context>","data-mutable":"<editable>"},selector:"paragraph-field,.paragraph-field-marker"},i.views.editor.options.template=n.theme.paragraphsEditorWidget,i.views.export.options.template=n.theme.paragraphsEditorExport,this.instances[t]=new WidgetBinder(i)}},{"./BundleSelector":1,"./WidgetBindingProtocol":2,"widget-binder":36}],4:[function(t,e,i){var n=window._;window.jQuery;e.exports=function(t){this._editorModel=t,this._widgetFactory=t.widgetFactory,this._viewFactory=t.viewFactory,this._widgetStore=t.widgetStore,this._editBufferMediator=t.editBufferMediator,this._editBufferMediator=t.editBufferMediator},n.extend(e.exports.prototype,{create:function(t,e){this._editBufferMediator.requestBufferItem(e,t)},bind:function(t,e,i){var n=this._widgetFactory.create(t,e,i),o=n.editBufferItemRef.targetContext,r=n.editBufferItemRef.sourceContext,s=this._viewFactory.create(n,i,"editor");this._widgetStore.add(n,s),s.isEditorViewRendered()?s.save():this._viewFactory.createTemporary(n,i,"export").save();var d=r.get("id")===o.get("id");this._widgetStore.count(n)>1||!d?n.duplicate():s.render()},unbind:function(t){this._applyToModel(t,function(t){this._widgetStore.remove(t,!0)})},get:function(t){return this._widgetStore.get(t).model},edit:function(t){this._applyToModel(t,function(t){t.edit()})},save:function(t,e){return this._applyToModel(t,function(t){this._viewFactory.createTemporary(t,e,"editor").save(),this._viewFactory.createTemporary(t,e,"export").render().save()})},destroy:function(t,e){this._applyToModel(t,function(t){e&&t.setState(WidgetModel.State.DESTROYED_WIDGET),t.destroy()})},close:function(){this._editorModel.destroy(),this._widgetStore.cleanup(),this._editBufferMediator.cleanup()},_applyToModel:function(t,e){var i=this.get(t);if(i)return e.apply(this,[i]),i}})},{}],5:[function(t,e,i){"use strict";var n=window.Backbone,o=t("./EditBufferItemCollection"),r=t("../Models/ContextModel");e.exports=n.Collection.extend({model:r,get:function(t,e,i){if("string"==typeof t&&!i&&!n.Collection.prototype.get.call(this,t)){e||(e={});var s=new o([],{contextId:t}),d=new r({id:t},{editBuffer:s,settings:e});this.add(d)}return n.Collection.prototype.get.call(this,t)},touch:function(t){this.get(t)}})},{"../Models/ContextModel":21,"./EditBufferItemCollection":6}],6:[function(t,e,i){"use strict";var n=window.Backbone,o=t("../Models/EditBufferItemModel");e.exports=n.Collection.extend({model:o,initialize:function(t,e){this._contextId=e.contextId},getItem:function(t,e){var i=this.get(e);return i||(i=this.add({id:e},{merge:!0}),t.render(this.getContextId(),e)),i},setItem:function(t){return this.add(t,{merge:!0})},removeItem:function(t){this.remove(t)},getContextId:function(){return this._contextId}})},{"../Models/EditBufferItemModel":22}],7:[function(t,e,i){"use strict";var n=window.Backbone,o=t("../Models/EditorModel");e.exports=n.Collection.extend({model:o})},{"../Models/EditorModel":23}],8:[function(t,e,i){"use strict";var n=window.Backbone,o=t("../Models/SchemaModel");e.exports=n.Collection.extend({model:o,initialize:function(t,e){this.listenTo(e.contextCollection,"add",this.addContextSchema),this._dispatcher=e.dispatcher},isAllowed:function(t,e){var i=this.get(t);return!(!i||!i.get("allowed")[e])},addContextSchema:function(t){var e=t.get("field");e&&this._dispatcher.dispatch("FETCH_SCHEMA",{},e)}})},{"../Models/SchemaModel":24}],9:[function(t,e,i){"use strict";var n=window.Backbone,o=t("../Models/WidgetModel");e.exports=n.Collection.extend({model:o})},{"../Models/WidgetModel":25}],10:[function(t,e,i){"use strict";var n=window._,o=window.Backbone;e.exports=function(){},n.extend(e.exports.prototype,o.Events,{addContext:function(t){return this.listenTo(t.editBuffer,"add",this._triggerEvents),this},_triggerEvents:function(t){t.get("insert")?(this.trigger("insertItem",t),t.set({insert:!1})):this.trigger("updateItem",t)},cleanup:function(){this.stopListening()}})},{}],11:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e,i,n){this._contextCollection=t,this._sourceContextAttribute=e,this._targetContextAttribute=i,this._editorContext=n},n.extend(e.exports.prototype,{resolveTargetContext:function(t){var e=t.attr(this._targetContextAttribute);return e||(e=t.closest("["+this._targetContextAttribute+"]").attr(this._targetContextAttribute)),this.get(e)},resolveSourceContext:function(t){var e=t.attr(this._sourceContextAttribute);return e?this.get(e):this._editorContext},getEditorContext:function(){return this._editorContext},get:function(t){if(t){var e=this._editorContext?this._editorContext.getSettings():{};return this._contextCollection.get(t,e)}return this._editorContext},touch:function(t){return this._contextCollection.touch(t)}})},{}],12:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e,i,n){this.editBufferItem=t,this.sourceContext=e,this.targetContext=i,this._commandEmitter=n},n.extend(e.exports.prototype,{edit:function(t){this._commandEmitter.edit(this.targetContext.get("id"),this.editBufferItem.get("id"),t)},render:function(t){this._commandEmitter.render(this.targetContext.get("id"),this.editBufferItem.get("id"),t)},duplicate:function(t,e){this._commandEmitter.duplicate(this.targetContext.get("id"),this.sourceContext.get("id"),this.editBufferItem.get("id"),t,e)}})},{}],13:[function(t,e,i){"use strict";var n=window._,o=t("./EditBufferItemRef");e.exports=function(t,e){this._contextResolver=t,this._commandEmitter=e},n.extend(e.exports.prototype,{create:function(t,e,i){var n=this._contextResolver.get(t.collection.getContextId());return e||(e=n),i||(i=n),new o(t,e,i,this._commandEmitter)},createFromIds:function(t,e,i){if(!e||!i)throw new Error("Source and target context ids are explicitly required");var n=this._contextResolver.get(e),o=this._contextResolver.get(i),r=n.editBuffer.getItem(this._commandEmitter,t);return this.create(r,n,o)},requestNewItem:function(t,e){this._commandEmitter.insert(t,e)}})},{"./EditBufferItemRef":12}],14:[function(t,e,i){"use strict";var n=window._,o=window.Backbone;e.exports=function(t,e,i,n,o){this._editBufferItemRefFactory=t,this._elementFactory=e,this._contextListener=i,this._adapter=n,this._contextResolver=o,this.listenTo(this._contextListener,"insertItem",this._insertBufferItem)},n.extend(e.exports.prototype,o.Events,{requestBufferItem:function(t,e){var i=this._contextResolver.resolveTargetContext(e);this._contextListener.addContext(i),this._editBufferItemRefFactory.requestNewItem(i.get("id"),t)},cleanup:function(){this._contextListener.cleanup(),this.stopListening()},_insertBufferItem:function(t){var e=this._editBufferItemRefFactory.create(t),i=this._elementFactory.create("widget",{uuid:t.get("id"),context:e.targetContext.get("id")});i.setAttribute("<viewmode>","editor"),this._adapter.insertEmbedCode(i)}})},{}],15:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e){this._dispatcher=t,this._editorContext=e},n.extend(e.exports.prototype,{insert:function(t,e){var i={command:"insert",targetContext:t};e&&(i.bundleName=e),this._execute("INSERT_ITEM",i)},edit:function(t,e,i){this._execute("EDIT_ITEM",{command:"edit",targetContext:t,itemId:e,edits:i})},render:function(t,e,i){this._execute("RENDER_ITEM",{command:"render",targetContext:t,itemId:e,edits:i})},duplicate:function(t,e,i,n,o){this._execute("DUPLICATE_ITEM",{command:"duplicate",targetContext:t,sourceContext:e,itemId:i,widget:n,edits:o})},_execute:function(t,e){this._dispatcher.dispatch(t,e,this._editorContext.getSettings())}})},{}],16:[function(t,e,i){"use strict";var n=window._,o=t("../../Models/WidgetModel");e.exports=function(t,e,i){this._contextResolver=t,this._editBufferItemRefFactory=e,this._uuidAttributeName=i},n.extend(e.exports.prototype,{create:function(t,e,i){var n=this._contextResolver.resolveSourceContext(i),r=this._contextResolver.resolveTargetContext(i),s={editBufferItemRefFactory:this._editBufferItemRefFactory,contextResolver:this._contextResolver,widget:t};return new o({id:e,contextId:r.get("id"),itemId:i.attr(this._uuidAttributeName),itemContextId:n.get("id")},s)}})},{"../../Models/WidgetModel":25}],17:[function(t,e,i){"use strict";var n=window._,o=window.Backbone,r=t("../../Models/WidgetModel"),s=t("../../Collections/WidgetCollection");e.exports=function(t){this._adapter=t,this._views={},this._widgetCollection=new s},n.extend(e.exports.prototype,o.Events,{add:function(t,e){if(!(t instanceof o.Model)){var i=t;if(!(t=this._widgetCollection.get(i.id)))throw new Error("Attempt to update an unknown widget.");t.set(i)}if(t.collection){if(t.collection!==this._widgetCollection)throw new Error("The widget being added already belongs to another editor.")}else this.listenTo(t,"destroy",this.remove),this.listenTo(t,"change:itemId",this._updateItemReference),this._widgetCollection.add(t);if(e){var n=t.get("itemId"),r=t.get("id");this._views[n]||(this._views[n]={}),this._views[n][r]=e}},get:function(t){var e=this._widgetCollection.get(t);if(e){var i=e.get("itemId"),n=e.get("id");return{model:e,view:this._readCell(i,n)}}return{model:null,view:null}},remove:function(t,e){var i=t.get("itemId"),n=t.get("id");if(t.hasState(r.State.DESTROYED_WIDGET)||e||this._adapter.destroyWidget(t.get("id")),this._views[i]&&this._views[i][n]){var o=this._views[i][n];delete this._views[i][n],o.remove()}this._cleanRow(i),this._widgetCollection.remove(t),t.setState(r.State.DESTROYED_REFS)},count:function(t){var e=0;if(t){var i=t.get("itemId");for(var n in this._views[i])this._readCell(i,n)&&e++}return e},cleanup:function(){for(var t in this._views){for(var e in this._views[t])this._views[t][e].remove();delete this._views[t]}this._widgetCollection.reset(),this._adapter.cleanup(),this.stopListening()},_readCell:function(t,e){var i=null;return this._views[t]&&this._views[t][e]&&(i=this._views[t][e],this._adapter.getRootEl().contains(i.el)||(this.remove(i.model),i=null)),i},_cleanRow:function(t){this._views[t]&&n.isEmpty(this._views[t])&&delete this._views[t]},_updateItemReference:function(t){var e=t.previous("itemId"),i=t.get("id"),n=t.get("itemId");this._views[e]&&this._views[e][i]&&(this._views[n]||(this._views[n]={}),this._views[n][i]=this._views[e][i],delete this._views[e][i]),this._cleanRow(e)}})},{"../../Collections/WidgetCollection":9,"../../Models/WidgetModel":25}],18:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e){this._elementFactory=t,this._adapter=e,this._viewModes=[]},n.extend(e.exports.prototype,{register:function(t,e){if(!e||!e.prototype)throw new Error("View mode requires a view prototype.");return this._viewModes[t]=e},create:function(t,e,i){i||(i=t.get("viewMode"));var o=this._viewModes[i];if(!o)throw new Error('Invalid view mode "'+i+'"');var r=o.options?o.options:{};return new o.prototype(n.extend({model:t,adapter:this._adapter,elementFactory:this._elementFactory,el:e.get(0)},r))},createTemporary:function(t,e,i){return this.create(t,e,i).stopListening()}})},{}],19:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e,i,o){var r=this;e||(e={}),this._tag=t,this._attributeMap=e,this._selector=i,this._invertedAttributeMap={},n.each(e,function(t,e){r._invertedAttributeMap[r._getDataKey(t)]=e}),o||(o={});var s={};n.each(e,function(t,e){var i=r._getDataKey(t);i?o[i]&&(s[e]=o[i]):s[e]=t}),this._attributes=s},n.extend(e.exports.prototype,{getTag:function(){return this._tag},getAttributes:function(){return this._attributes},getAttributeNames:function(){return n.keys(this._attributeMap)},setAttribute:function(t,e){return this._attributes[this.getAttributeName(t)]=e,this},getAttribute:function(t){return this._attributes[this.getAttributeName(t)]},getAttributeName:function(t){var e=this._getDataKey(t);return e&&this._invertedAttributeMap[e]&&(t=this._invertedAttributeMap[e]),t},renderOpeningTag:function(){var t="<"+this.getTag();return n.each(this.getAttributes(),function(e,i){t+=" "+i+'="'+e+'"'}),t+">"},renderClosingTag:function(){return"</"+this.getTag()+">"},getSelector:function(){var t=this.getAttributes(),e="";if(this._selector)e=this._selector;else if(t.class){var i=t.class.split(" ");n.each(i,function(t){e+="."+t},this)}else e=this.getTag();return e},_getDataKey:function(t){var e=/^<([a-z\-]+)>$/,i=e.exec(t);return!(!i||!i[1])&&i[1]}})},{}],20:[function(t,e,i){"use strict";var n=window._,o=t("./Element");e.exports=function(t){this._elements=t,n.each(this._elements,function(t){t.attributes||(t.attributes={})})},n.extend(e.exports.prototype,{getTemplate:function(t){return this.create(t)},create:function(t,e){var i=this._elements[t];if(!i)throw new Error("Invalid element type.");return new o(i.tag,i.attributes,i.selector,e)}})},{"./Element":19}],21:[function(t,e,i){"use strict";var n=window.Backbone;e.exports=n.Model.extend({type:"Context",defaults:{field:"",settings:{}},constructor:function(t,e){this.editBuffer=e.editBuffer,t.settings||(t.settings={}),n.Model.apply(this,[t,e])},set:function(t,e){return t.editBufferItems&&(this.editBuffer.add(t.editBufferItems,{merge:!0}),delete t.editBufferItems),n.Model.prototype.set.call(this,t,e)},getSettings:function(){return this.get("settings")},getSetting:function(t){return this.get("settings")[t]}})},{}],22:[function(t,e,i){"use strict";var n=window.Backbone;e.exports=n.Model.extend({type:"EditBufferItem",defaults:{insert:!1,markup:"...",type:"",fields:{}}})},{}],23:[function(t,e,i){"use strict";var n=window.Backbone;e.exports=n.Model.extend({type:"Editor",initialize:function(t,e){this.widgetFactory=e.widgetFactory,this.viewFactory=e.viewFactory,this.widgetStore=e.widgetStore,this.editBufferMediator=e.editBufferMediator,this.context=e.context,this.listenTo(this.context,"change:id",this._updateContextId)},_updateContextId:function(t){this.set({id:t.get("id")})},destroy:function(){this.stopListening(),this.widgetStore.cleanup(),this.editBufferMediator.cleanup()}})},{}],24:[function(t,e,i){"use strict";var n=window.Backbone;e.exports=n.Model.extend({type:"Schema",defaults:{allowed:{}},isAllowed:function(t){return!!this.get("allowed")[t]}})},{}],25:[function(t,e,i){"use strict";var n=window._,o=window.Backbone,r={READY:1,DESTROYED_WIDGET:2,DESTROYED_REFS:4,DESTROYED:6};e.exports=o.Model.extend({type:"Widget",defaults:{itemId:0,contextId:"",markup:"",edits:{},duplicating:!1,state:r.READY},constructor:function(t,e){this.widget=e.widget,this._editBufferItemRefFactory=e.editBufferItemRefFactory,this._contextResolver=e.contextResolver,o.Model.apply(this,[t,e])},set:function(t,e){return this._filterAttributes(t),o.Model.prototype.set.call(this,t,e)},edit:function(){return this.editBufferItemRef.edit(this.get("edits")),this},duplicate:function(){return this.set({duplicating:!0}),this.editBufferItemRef.duplicate(this.get("id"),this.get("edits")),this},destroy:function(t){this.hasState(r.DESTROYED)||(this.trigger("destroy",this,this.collection,t),this.setState(r.DESTROYED))},setState:function(t){return this.set({state:this.get("state")|t})},hasState:function(t){return(this.get("state")&t)===t},_filterAttributes:function(t){(this._refreshEditBufferItemRef(t)||t.edits)&&this._setupListeners(t)},_refreshEditBufferItemRef:function(t){var e=!1,i=this.get("itemContextId"),n=this.get("contextId"),o=this.get("itemId"),r=t.itemContextId?t.itemContextId:i,s=t.contextId?t.contextId:n,d=t.itemId?t.itemId:o;return r==i&&s==n&&d==o||(this.editBufferItemRef=this._editBufferItemRefFactory.createFromIds(d,r,s),e=!0,t.markup=this.editBufferItemRef.editBufferItem.get("markup")),e},_setupListeners:function(t){this.stopListening().listenTo(this.editBufferItemRef.editBufferItem,"change:markup",this._readFromBufferItem).listenTo(this.editBufferItemRef.sourceContext,"change:id",this._updateContext).listenTo(this.editBufferItemRef.targetContext,"change:id",this._updateContext),n.each(t.edits,function(t,e){var i=this._contextResolver.get(e);this.listenTo(i,"change:id",this._updateContext)},this)},_readFromBufferItem:function(t){this.set({markup:t.get("markup")})},_updateContext:function(t){var e=t.previous("id"),i=t.get("id"),o={};this.get("itemContextId")==e&&(o.itemContextId=i),this.get("contextId")==e&&(o.contextId=i);var r=this.get("edits");r[e]&&(o.edits={},n.each(r,function(t,n){n==e?o.edits[i]=t.replace(e,i):o.edits[n]=t},this)),this.set(o,{silent:!0})}}),e.exports.State=r},{}],26:[function(t,e,i){"use strict";function n(){throw new Error("Unimplemented method.")}var o=window._,r=window.Backbone;e.exports=function(){},o.extend(e.exports.prototype,{insertEmbedCode:function(t){n()},destroyWidget:function(t){n()},attachInlineEditing:function(t,e,i){n()},getInlineEdit:function(t,e,i){return n()},getRootEl:function(){return n()},cleanup:function(){}}),e.exports.extend=r.Model.extend},{}],27:[function(t,e,i){"use strict";var n=window._,o=window.Backbone;e.exports=function(){},n.extend(e.exports.prototype,{send:function(t,e,i,n){throw new Error("Unimplemented method.")}}),e.exports.extend=o.Model.extend},{}],28:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e){this._protocol=t,this._resolver=e},n.extend(e.exports.prototype,{dispatch:function(t,e,i){this._protocol.send(t,e,i,this._resolver)}})},{}],29:[function(t,e,i){"use strict";var n=window._;e.exports=function(){this._collections={}},n.extend(e.exports.prototype,{addCollection:function(t,e){this._collections[t]=e},resolve:function(t){n.each(t,function(t,e){this._collections[e]&&this._updateModels(t,this._collections[e])},this)},_updateModels:function(t,e){var i=e;n.each(t,function(t,n){"function"==typeof e&&(i=e(t));var o=i.get(n);o?o.set(t):i.add(t)})}})},{}],30:[function(t,e,i){"use strict";e.exports=function(t,e){var i=t.create("widget-display"),n=t.create("toolbar"),o=t.create("toolbar-item"),r=t.create("widget-command");return i.renderOpeningTag()+e+n.renderOpeningTag()+o.renderOpeningTag()+r.setAttribute("<command>","edit").renderOpeningTag()+r.renderClosingTag()+o.renderClosingTag()+o.renderOpeningTag()+r.setAttribute("<command>","delete").renderOpeningTag()+r.renderClosingTag()+o.renderClosingTag()+n.renderClosingTag()+i.renderClosingTag()}},{}],31:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,i,o){var r="";return i&&n.each(i,function(i){var n,s=t.create(i.type,i);"field"==i.type&&(i.context?n=o[i.context]:s.setAttribute("<editable>","false")),r+=s.renderOpeningTag(),r+=n||e.exports(t,i.children,o),r+=s.renderClosingTag()}),r}},{}],32:[function(t,e,i){"use strict";var n=(window._,window.Backbone);e.exports=n.View.extend({initialize:function(t,e){this._elementFactory=e.elementFactory,this.listenTo(this.model,"change:id",this.render),this.listenTo(this.model,"destroy",this.stopListening),this.render()},render:function(){var t=this._elementFactory.getTemplate("field");this.$el.attr(t.getAttributeName("<context>"),this.model.get("context"))}})},{}],33:[function(t,e,i){"use strict";var n=window._,o=window.Backbone,r=o.$;e.exports=o.View.extend({initialize:function(t){this.adapter=t.adapter,this._elementFactory=t.elementFactory,this.template=t.template;var e=this._elementFactory.getTemplate("widget"),i=this._elementFactory.getTemplate("field"),n=this._elementFactory.getTemplate("widget-command");this.widgetSelector=e.getSelector(),this.viewModeAttribute=e.getAttributeName("<viewmode>"),this.inlineContextAttribute=i.getAttributeName("<context>"),this.commandSelector=n.getSelector(),this.commandAttribute=n.getAttributeName("<command>"),this.inlineEditorSelector=i.getSelector(),this.listenTo(this.model,"change",this._changeHandler)},template:function(t,e){},render:function(){if(this.model.get("duplicating"))this.$el.html(this.template(this._elementFactory,"..."));else{var t=this;this.$el.html(this.template(this._elementFactory,this.model.get("markup"))),this.$el.find(this.commandSelector).on("click",function(){var e=r(this).attr(t.commandAttribute);"edit"==e?t.save().edit():"remove"==e&&t.remove()}),this.renderAttributes(),this.renderEdits()}return this},renderAttributes:function(){var t=this._elementFactory.create("widget",{context:this.model.get("contextId"),uuid:this.model.get("itemId"),viewmode:"editor"});return n.each(t.getAttributes(),function(t,e){this.$el.attr(e,t)},this),this},renderEdits:function(){var t=this.model.get("edits");return this._inlineElementVisitor(function(e,i,n){e.html(t[i]?t[i]:""),this.adapter.attachInlineEditing(this,i,n)}),this},save:function(){if(!this.model.get("duplicating")){var t={};this._inlineElementVisitor(function(e,i,n){t[i]=this.adapter.getInlineEdit(this,i,n)}),this.model.set({edits:t},{silent:!0})}return this},rebase:function(){var t=n.pairs(this.model.get("edits")),e={};return this._inlineElementVisitor(function(i,n,o){var r=t.shift();e[n]=r?r[1]:""}),this.model.set({edits:e}),this},edit:function(){this.model.edit()},remove:function(){if(this.stopListening(),this.model){var t=this.model;this.model=null,t.destroy()}return this},stopListening:function(){return this.$el.find(this.commandSelector).off(),o.View.prototype.stopListening.call(this)},isEditorViewRendered:function(){return"editor"==this.$el.attr(this.viewModeAttribute)},_changeHandler:function(){return this.model.previous("duplicating")?this.render().rebase():this.model.get("duplicating")||this.model.hasChanged("markup")?this.render():(this.model.hasChanged("edits")&&this.renderEdits(),(this.model.hasChanged("itemId")||this.model.hasChanged("itemContextId"))&&this.renderAttributes()),this},_inlineElementVisitor:function(t){var e=this;this.$el.find(this.inlineEditorSelector).each(function(){if(r(this).closest(e.widgetSelector).is(e.$el)){var i=r(this).attr(e.inlineContextAttribute),n=e.inlineEditorSelector+"["+e.inlineContextAttribute+'="'+i+'"]';t.call(e,r(this),i,n)}})}})},{}],34:[function(t,e,i){"use strict";var n=window._,o=window.Backbone,r=o.$;e.exports=o.View.extend({initialize:function(t){this.adapter=t.adapter,this.elementFactory=t.elementFactory,this.template=t.template;var e=this.elementFactory.getTemplate("widget"),i=this.elementFactory.getTemplate("field");this.inlineContextAttribute=i.getAttributeName("<context>"),this.inlineEditorSelector=i.getSelector(),this.attributeWhitelist=n.invert(e.getAttributeNames()),delete this.attributeWhitelist[e.getAttributeName("<viewmode>")]},template:function(t,e,i){},render:function(){var t=this,e=this.model.editBufferItemRef.editBufferItem.get("fields"),i=this.model.get("edits");return this.$el.html(this.template(this.elementFactory,e,i)),n.each(this.el.attributes,function(e){n.isUndefined(t.attributeWhitelist[e.name])&&t.$el.removeAttr(e.name)}),this},save:function(){var t={},e=this;return this.$el.find(this.inlineEditorSelector).each(function(){var i=r(this).attr(e.inlineContextAttribute);t[i]=r(this).html()}),this.model.set({edits:t},{silent:!0}),this},remove:function(){}})},{}],35:[function(t,e,i){"use strict";e.exports={name:"default",servicePrototypes:{Binder:t("./Binder"),CommandEmitter:t("./Editor/Command/CommandEmitter"),ContextCollection:t("./Collections/ContextCollection"),ContextListener:t("./Context/ContextListener"),ContextResolver:t("./Context/ContextResolver"),EditBufferItemRefFactory:t("./EditBuffer/EditBufferItemRefFactory"),EditBufferMediator:t("./EditBuffer/EditBufferMediator"),EditorCollection:t("./Collections/EditorCollection"),ElementFactory:t("./Element/ElementFactory"),SchemaCollection:t("./Collections/SchemaCollection"),SyncActionDispatcher:t("./SyncAction/SyncActionDispatcher"),SyncActionResolver:t("./SyncAction/SyncActionResolver"),WidgetFactory:t("./Editor/Widget/WidgetFactory"),WidgetStore:t("./Editor/Widget/WidgetStore"),WidgetViewFactory:t("./Editor/Widget/WidgetViewFactory"),EditorView:t("./Views/EditorView")},views:{editor:{prototype:t("./Views/WidgetEditorView"),options:{template:t("./Templates/WidgetEditorViewTemplate")}},export:{prototype:t("./Views/WidgetMementoView"),options:{template:t("./Templates/WidgetMementoViewTemplate")}}},plugins:{adapter:null,protocol:null},elements:{widget:{tag:"div",attributes:{"data-uuid":"<uuid>","data-context-hint":"<context>","data-viewmode":"<viewmode>",class:"widget-binder-widget"}},field:{tag:"div",attributes:{"data-field-name":"<field>","data-context":"<context>","data-mutable":"<editable>",class:"widget-binder-field"}},"widget-display":{tag:"div",attributes:{class:"widget-binder-widget__display"}},toolbar:{tag:"ul",attributes:{class:"widget-binder-toolbox"}},"toolbar-item":{tag:"li",attributes:{class:"widget-binder-toolbox__item"}},"widget-command":{tag:"a",attributes:{class:"widget-binder-command","data-command":"<command>",href:"#"}}},data:{context:{},schema:{}}}},{"./Binder":4,"./Collections/ContextCollection":5,"./Collections/EditorCollection":7,"./Collections/SchemaCollection":8,"./Context/ContextListener":10,"./Context/ContextResolver":11,"./EditBuffer/EditBufferItemRefFactory":13,"./EditBuffer/EditBufferMediator":14,"./Editor/Command/CommandEmitter":15,"./Editor/Widget/WidgetFactory":16,"./Editor/Widget/WidgetStore":17,"./Editor/Widget/WidgetViewFactory":18,"./Element/ElementFactory":20,"./SyncAction/SyncActionDispatcher":28,"./SyncAction/SyncActionResolver":29,"./Templates/WidgetEditorViewTemplate":30,"./Templates/WidgetMementoViewTemplate":31,"./Views/EditorView":32,"./Views/WidgetEditorView":33,"./Views/WidgetMementoView":34}],36:[function(t,e,i){"use strict";var n=window._;e.exports=function(t){t||(t={}),this._initialize(t)},n.extend(e.exports,{defaults:t("./config"),PluginInterface:{EditorAdapter:t("./Plugins/EditorAdapter"),SyncProtocol:t("./Plugins/SyncProtocol")}}),n.extend(e.exports.prototype,{getInstanceName:function(){return this._globalSettings.name},getElementFactory:function(){return this._elementFactory},getViewFactory:function(){return this._viewFactory},getContexts:function(){return this._contextCollection},getSchema:function(){return this._schemaCollection},getEditors:function(){return this._editorCollection},getSyncActionDispatcher:function(){return this._syncActionDispatcher},getSyncActionResolver:function(){return this._syncActionResolver},open:function(t){var e,i=this._createContextResolver().resolveTargetContext(t),n=i?i.get("id"):null;if(n){if(this._editorCollection.get(n))throw new Error("Existing binder already open for this editor instance.");var o=this._createContextResolver(i),r=this._createService("CommandEmitter",this._syncActionDispatcher,i),s=this._createService("EditBufferItemRefFactory",o,r),d=this._createService("ContextListener");d.addContext(i);var a=this._globalSettings.plugins.adapter,c=this._elementFactory.getTemplate("widget").getAttributeName("<uuid>"),l=this._createService("WidgetFactory",o,s,c),u=this._createService("WidgetStore",a),h=this._createService("EditBufferMediator",s,this._elementFactory,d,a,o);return e=new this._globalSettings.servicePrototypes.EditorCollection.prototype.model({id:n},{widgetFactory:l,viewFactory:this._viewFactory,widgetStore:u,editBufferMediator:h,context:i}),this._createService("EditorView",{model:e,el:t[0]},{elementFactory:this._elementFactory}),this._editorCollection.set(e),this._createService("Binder",e,h)}},_initialize:function(t){this._globalSettings=n.defaults(t,e.exports.defaults),this._syncActionResolver=this._createService("SyncActionResolver"),this._syncActionDispatcher=this._createService("SyncActionDispatcher",this._globalSettings.plugins.protocol,this._syncActionResolver);var i=this._createService("EditorCollection"),o=this._createService("ContextCollection"),r=this._createService("SchemaCollection",[],{contextCollection:o,dispatcher:this._syncActionDispatcher});this._editorCollection=r,this._contextCollection=o,this._schemaCollection=r,this._syncActionResolver.addCollection("context",this._contextCollection),this._syncActionResolver.addCollection("schema",this._schemaCollection),this._syncActionResolver.addCollection("editBufferItem",function(t){return o.get(t.contextId).editBuffer}),this._syncActionResolver.addCollection("widget",function(t){return i.get(t.contextId).widgetStore}),this._elementFactory=this._createService("ElementFactory",this._globalSettings.elements),this._viewFactory=this._createService("WidgetViewFactory",this._elementFactory,this._globalSettings.plugins.adapter);for(var s in this._globalSettings.views)this._viewFactory.register(s,this._globalSettings.views[s]);t.data&&this._syncActionResolver.resolve(t.data)},_createContextResolver:function(t){var e=this._elementFactory.getTemplate("widget").getAttributeName("<context>"),i=this._elementFactory.getTemplate("field").getAttributeName("<context>");return this._createService("ContextResolver",this._contextCollection,e,i,t)},_createService:function(t){for(var e=[],i=1;i<arguments.length;++i)e.push(arguments[i]);var n=this._globalSettings.servicePrototypes[t];switch(e.length){case 0:return new n;case 1:return new n(e[0]);case 2:return new n(e[0],e[1]);case 3:return new n(e[0],e[1],e[2]);case 4:return new n(e[0],e[1],e[2],e[3]);case 5:return new n(e[0],e[1],e[2],e[3],e[4]);default:throw new Error("Really, you need to inject more than five services? Consider factoring "+t+" into separate classes.")}}})},{"./Plugins/EditorAdapter":26,"./Plugins/SyncProtocol":27,"./config":35}]},{},[3]);