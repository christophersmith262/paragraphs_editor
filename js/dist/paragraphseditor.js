!function t(e,i,n){function o(s,a){if(!i[s]){if(!e[s]){var d="function"==typeof require&&require;if(!a&&d)return d(s,!0);if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=i[s]={exports:{}};e[s][0].call(c.exports,function(t){var i=e[s][1][t];return o(i||t)},c,c.exports,t,e,i,n)}return i[s].exports}for(var r="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,i){var n=window.Drupal,o=window.jQuery;n.behaviors.paragraphs_editor_bundleselector={attach:function(t){o(".paragraphs-editor-bundle-selector-search",t).each(function(){var t=o(this),e=t.find(".paragraphs-editor-bundle-selector-search__input"),i=t.find(".paragraphs-editor-bundle-selector-search__submit");e.keyup(function(t){i.mousedown()}).blur(function(){o(this).trigger("focus")})})}}},{}],2:[function(t,e,i){var n=window.Drupal,o=window.jQuery,r=t("widget-binder");e.exports=r.PluginInterface.SyncProtocol.extend({constructor:function(t){this.moduleName=t},send:function(t,e,i){"FETCH_SCHEMA"==t?this._get(e,i):this._sendAjaxCommand(e,i)},_sendAjaxCommand:function(t,e){if(t.command){var i="/ajax/paragraphs-editor/"+t.command;t.targetContext&&(i+="/"+t.targetContext),t.sourceContext&&(i+="/"+t.sourceContext),t.itemId&&(i+="/"+t.itemId),_.isUndefined(t.widget)||(i+="/"+t.widget),t.type&&(i+="/"+t.type);var o=[];for(var r in t.settings)o.push("settings["+r+"]="+t.settings[r]);o.push("module="+this.moduleName),i+="?"+o.join("&");var s=n.ajax({url:i,progress:{message:""}});s.options.data.editorContext=t.editorContext.id,t.editableContexts&&_.each(t.editableContexts,function(t){var e="editableContexts";e+="["+t.ownerId+"]",e+="["+t.fieldId+"]",s.options.data[e]=t.id}),"duplicate"==t.command&&t.edits&&_.each(t.edits,function(t,e){s.options.data["edits["+e+"]"]=t});var a=s.options.complete;s.options.complete=function(t,e){a.call(s.options,t,e),n.ajax.instances.splice(s.instanceIndex,1)},s.execute()}},_get:function(t,e){o.get("/ajax/paragraphs-editor/schema/"+t,"",function(t){e.resolve(t)})}})},{"widget-binder":37}],3:[function(t,e,i){var n=window._,o=window.Drupal,r=window.drupalSettings,s=(window.jQuery,t("./WidgetBindingProtocol"));WidgetBinder=t("widget-binder"),t("./BundleSelector"),o.paragraphs_editor={},o.AjaxCommands.prototype.paragraphs_editor_data=function(t,e,i){var n=e.module;delete e.module,o.paragraphs_editor.instances[n].getSyncActionResolver().resolve(e)},o.theme.paragraphsEditorWidget=function(t,e,i){return n.each(i,function(t,e){t.title=o.t(t.title)}),WidgetBinder.defaults.views.editor.options.template(t,e,i)},o.theme.paragraphsEditorExport=function(t,e,i){return WidgetBinder.defaults.views.export.options.template(t,e,i)},o.paragraphs_editor.instances={},o.paragraphs_editor.register=function(t,e){var i=WidgetBinder.config();return i.plugins={adapter:e,protocol:new s(t)},i.elements.widget={tag:"paragraph",attributes:{"data-uuid":"<uuid>","data-context-hint":"<context>","data-viewmode":"<viewmode>"},selector:"paragraph[data-context-hint]"},i.elements.field={tag:"paragraph-field",attributes:{"data-field-name":"<name>","data-context":"<context>","data-mutable":"<editable>"},selector:'paragraph-field[data-mutable="true"],.editable-paragraph-field'},i.views.editor.options.template=o.theme.paragraphsEditorWidget,i.views.export.options.template=o.theme.paragraphsEditorExport,i.data=r.paragraphs_editor,this.instances[t]=new WidgetBinder(i)},o.paragraphs_editor.WidgetBinder=WidgetBinder},{"./BundleSelector":1,"./WidgetBindingProtocol":2,"widget-binder":37}],4:[function(t,e,i){"use strict";var n=window._,o=window.Backbone,r=t("./Models/WidgetModel");e.exports=function(t){this._editorView=t,this._widgetFactory=t.model.widgetFactory,this._viewFactory=t.model.viewFactory,this._widgetStore=t.model.widgetStore,this._editBufferMediator=t.model.editBufferMediator,this._contextResolver=t.model.contextResolver},n.extend(e.exports.prototype,o.Events,{create:function(t,e){this._editBufferMediator.requestBufferItem(e,t)},bind:function(t,e,i){var n=this._widgetFactory.create(t,e,i),o=n.editBufferItemRef.targetContext,s=n.editBufferItemRef.sourceContext,a=this._viewFactory.create(n,i,"editor");this._widgetStore.add(n,a),this.trigger("bind",this,n,a),this.listenTo(n,"change",function(){n.hasState(r.State.DESTROYED_REFS)&&(this.trigger("unbind",this,n,a),this.stopListening(n)),n.hasState(r.State.DESTROYED_WIDGET)&&this.trigger("destroy",this,n,a)},this),this.listenTo(n,"save",function(){this.trigger("save",this,n,a)},this),a.isEditorViewRendered()?a.save():this._viewFactory.createTemporary(n,i,"export").save();var d=s.get("id")===o.get("id");return this._widgetStore.count(n)>1||!d?n.duplicate():a.render(),n},unbind:function(t){return this._applyToModel(t,function(t){this._widgetStore.remove(t,!0)})},get:function(t){return this._widgetStore.get(t,!0).model},edit:function(t){return this._applyToModel(t,function(t){t.edit()})},save:function(t,e){return this._applyToModel(t,function(t){t.trigger("save"),this._viewFactory.createTemporary(t,e,"editor").save(),this._viewFactory.createTemporary(t,e,"export").render().save()})},destroy:function(t,e){this._applyToModel(t,function(t){e&&t.setState(r.State.DESTROYED_WIDGET),t.destroy()})},close:function(){this._editorView.model.destroy(),this._editorView.stopListening(),this._widgetStore.cleanup(),this._editBufferMediator.cleanup()},getSettings:function(){return this._contextResolver.getEditorContext().get("settings")},setSettings:function(t){this._contextResolver.getEditorContext().set({settings:t})},getSetting:function(t){return this._contextResolver.getEditorContext().getSetting(t)},resolveContext:function(t,e){if(e||(e="target"),"target"==e)return this._contextResolver.resolveTargetContext(t);if("source"==e)return this._contextResolver.resolveSourceContext(t);throw new Error("Invalid context type.")},_applyToModel:function(t,e){var i=this.get(t);if(i)return e.apply(this,[i]),i}})},{"./Models/WidgetModel":25}],5:[function(t,e,i){"use strict";var n=window.Backbone,o=t("../Models/ContextModel");e.exports=n.Collection.extend({model:o,get:function(t,e,i){if("string"==typeof t&&!i&&!n.Collection.prototype.get.call(this,t)){e||(e={});var r=new o({id:t,settings:e});this.add(r)}return n.Collection.prototype.get.call(this,t)},touch:function(t){this.get(t)}})},{"../Models/ContextModel":21}],6:[function(t,e,i){"use strict";var n=window.Backbone,o=t("../Models/EditBufferItemModel");e.exports=n.Collection.extend({model:o,initialize:function(t,e){this._contextId=e.contextId},getItem:function(t,e){var i=this.get(e);return i||(i=this.add({id:e},{merge:!0}),t.render(this.getContextId(),e)),i},setItem:function(t){return this.add(t,{merge:!0})},removeItem:function(t){this.remove(t)},getContextId:function(){return this._contextId}})},{"../Models/EditBufferItemModel":22}],7:[function(t,e,i){"use strict";var n=window.Backbone,o=t("../Models/EditorModel");e.exports=n.Collection.extend({model:o})},{"../Models/EditorModel":23}],8:[function(t,e,i){"use strict";var n=window.Backbone,o=t("../Models/SchemaModel");e.exports=n.Collection.extend({model:o,initialize:function(t,e){this.listenTo(e.contextCollection,"add",this.addContextSchema),this._dispatcher=e.dispatcher},isAllowed:function(t,e){var i=this.get(t);return!(!i||!i.get("allowed")[e])},addContextSchema:function(t){this._fetchSchema(t),this.listenTo(t,"change:schemaId",this._fetchSchema)},_fetchSchema:function(t){var e=t.get("schemaId");e&&(this.get(e)||(this.add({id:e}),this._dispatcher.dispatch("FETCH_SCHEMA",e)))}})},{"../Models/SchemaModel":24}],9:[function(t,e,i){"use strict";var n=window.Backbone,o=t("../Models/WidgetModel");e.exports=n.Collection.extend({model:o})},{"../Models/WidgetModel":25}],10:[function(t,e,i){"use strict";var n=window._,o=window.Backbone;e.exports=function(){},n.extend(e.exports.prototype,o.Events,{addContext:function(t){return this.listenTo(t.editBuffer,"add",this._triggerEvents),this},_triggerEvents:function(t){t.get("insert")?(this.trigger("insertItem",t),t.set({insert:!1})):this.trigger("updateItem",t)},cleanup:function(){this.stopListening()}})},{}],11:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e,i,n){this._contextCollection=t,this._sourceContextAttribute=e,this._targetContextAttribute=i,this._editorContext=n},n.extend(e.exports.prototype,{resolveTargetContext:function(t){var e=t.attr(this._targetContextAttribute);return e||(e=t.closest("["+this._targetContextAttribute+"]").attr(this._targetContextAttribute)),this.get(e)},resolveSourceContext:function(t,e){e||(e=this._editorContext);var i=t.attr(this._sourceContextAttribute);return i?this.get(i):e},getEditorContext:function(){return this._editorContext},get:function(t){if(t){var e=this._editorContext?this._editorContext.get("settings"):{};return this._contextCollection.get(t,e)}return this._editorContext},touch:function(t){this._contextCollection.touch(t)}})},{}],12:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e,i,n){this.editBufferItem=t,this.sourceContext=e,this.targetContext=i,this._commandEmitter=n},n.extend(e.exports.prototype,{edit:function(t){this._commandEmitter.edit(this.targetContext.get("id"),this.editBufferItem.get("id"),t)},render:function(t){this._commandEmitter.render(this.targetContext.get("id"),this.editBufferItem.get("id"),t)},duplicate:function(t,e){this._commandEmitter.duplicate(this.targetContext.get("id"),this.sourceContext.get("id"),this.editBufferItem.get("id"),t,e)}})},{}],13:[function(t,e,i){"use strict";var n=window._,o=t("./EditBufferItemRef");e.exports=function(t,e){this._contextResolver=t,this._commandEmitter=e},n.extend(e.exports.prototype,{create:function(t,e,i){var n=this._contextResolver.get(t.collection.getContextId());return e||(e=n),i||(i=n),new o(t,e,i,this._commandEmitter)},createFromIds:function(t,e,i){if(!e||!i)throw new Error("Source and target context ids are explicitly required");var n=this._contextResolver.get(e),o=this._contextResolver.get(i),r=n.editBuffer.getItem(this._commandEmitter,t);return this.create(r,n,o)},requestNewItem:function(t,e){this._commandEmitter.insert(t,e)}})},{"./EditBufferItemRef":12}],14:[function(t,e,i){"use strict";var n=window._,o=window.Backbone;e.exports=function(t,e,i,n,o){this._editBufferItemRefFactory=t,this._elementFactory=e,this._contextListener=i,this._adapter=n,this._contextResolver=o,this.listenTo(this._contextListener,"insertItem",this._insertBufferItem)},n.extend(e.exports.prototype,o.Events,{requestBufferItem:function(t,e){var i=this._contextResolver.resolveTargetContext(e);this._contextListener.addContext(i),this._editBufferItemRefFactory.requestNewItem(i.get("id"),t)},cleanup:function(){this._contextListener.cleanup(),this.stopListening()},_insertBufferItem:function(t){var e=this._editBufferItemRefFactory.create(t),i=this._elementFactory.create("widget",{uuid:t.get("id"),context:e.targetContext.get("id")});i.setAttribute("<viewmode>","editor"),this._adapter.insertEmbedCode(i)}})},{}],15:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e){this._dispatcher=t,this._contextResolver=e},n.extend(e.exports.prototype,{insert:function(t,e){var i={command:"insert",targetContext:t};e&&(i.type=e),this._execute("INSERT_ITEM",i)},edit:function(t,e,i){this._execute("EDIT_ITEM",{command:"edit",targetContext:t,itemId:e,edits:i})},render:function(t,e,i){this._execute("RENDER_ITEM",{command:"render",targetContext:t,itemId:e,edits:i})},duplicate:function(t,e,i,n,o){this._execute("DUPLICATE_ITEM",{command:"duplicate",targetContext:t,sourceContext:e,itemId:i,widget:n,edits:o})},_execute:function(t,e){var i=this._contextResolver.getEditorContext();e.editorContext=i.toJSON(),e.settings=i.get("settings"),e.edits&&(e.editableContexts={},n.each(e.edits,function(t,i){var n=this._contextResolver.get(i);e.editableContexts[i]=n.toJSON()},this)),this._dispatcher.dispatch(t,e)}})},{}],16:[function(t,e,i){"use strict";var n=window._,o=t("../../Models/WidgetModel");e.exports=function(t,e,i){this._contextResolver=t,this._editBufferItemRefFactory=e,this._uuidAttributeName=i},n.extend(e.exports.prototype,{create:function(t,e,i){var n=this._contextResolver.resolveTargetContext(i),r=this._contextResolver.resolveSourceContext(i,n),s={editBufferItemRefFactory:this._editBufferItemRefFactory,contextResolver:this._contextResolver,widget:t};return new o({id:e,contextId:n.get("id"),itemId:i.attr(this._uuidAttributeName),itemContextId:r.get("id")},s)}})},{"../../Models/WidgetModel":25}],17:[function(t,e,i){"use strict";var n=window._,o=window.Backbone,r=t("../../Models/WidgetModel"),s=t("../../Collections/WidgetCollection");e.exports=function(t){this._adapter=t,this._views={},this._widgetCollection=new s},n.extend(e.exports.prototype,o.Events,{add:function(t,e){if(!(t instanceof o.Model)){var i=t;if(!(t=this._widgetCollection.get(i.id)))throw new Error("Attempt to update an unknown widget.");t.set(i)}if(t.collection){if(t.collection!==this._widgetCollection)throw new Error("The widget being added already belongs to another editor.")}else this.listenTo(t,"destroy",this._removeWrapper),this.listenTo(t,"change:itemId",this._updateItemReference),this._widgetCollection.add(t);if(e){var n=t.get("itemId"),r=t.get("id");this._views[n]||(this._views[n]={}),this._views[n][r]=e}return t},get:function(t,e){var i=this._widgetCollection.get(t);if(i&&!e){var n=i.get("itemId"),o=i.get("id");return{model:i,view:this._readCell(n,o)}}return{model:i||null,view:null}},remove:function(t,e){if(t){var i=t.get("itemId"),n=t.get("id");if(t.hasState(r.State.DESTROYED_WIDGET)||e||this._adapter.destroyWidget(t.get("id")),this._views[i]&&this._views[i][n]){var o=this._views[i][n];delete this._views[i][n],o.remove()}return this._cleanRow(i),this._widgetCollection.remove(t),t.setState(r.State.DESTROYED_REFS),t}},count:function(t){var e=0;if(t){var i=t.get("itemId");for(var n in this._views[i])this._readCell(i,n)&&e++}return e},cleanup:function(){for(var t in this._views){for(var e in this._views[t])this._views[t][e].remove();delete this._views[t]}return this._widgetCollection.reset(),this._adapter.cleanup(),this.stopListening()},_readCell:function(t,e){var i=null;return this._views[t]&&this._views[t][e]&&(i=this._views[t][e],this._adapter.getRootEl().contains(i.el)||(this.remove(i.model),i=null)),i},_cleanRow:function(t){this._views[t]&&n.isEmpty(this._views[t])&&delete this._views[t]},_updateItemReference:function(t){var e=t.previous("itemId"),i=t.get("id"),n=t.get("itemId");this._views[e]&&this._views[e][i]&&(this._views[n]||(this._views[n]={}),this._views[n][i]=this._views[e][i],delete this._views[e][i]),this._cleanRow(e)},_removeWrapper:function(t){this.remove(t)}})},{"../../Collections/WidgetCollection":9,"../../Models/WidgetModel":25}],18:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e,i){this._contextResolver=t,this._elementFactory=e,this._adapter=i,this._viewModes=[]},n.extend(e.exports.prototype,{register:function(t,e){if(!e||!e.prototype)throw new Error("View mode requires a view prototype.");return this._viewModes[t]=e},create:function(t,e,i){i||(i=t.get("viewMode"));var o=this._viewModes[i];if(!o)throw new Error('Invalid view mode "'+i+'"');var r=o.options?o.options:{};return new o.prototype(n.extend({model:t,adapter:this._adapter,elementFactory:this._elementFactory,contextResolver:this._contextResolver,el:e.get(0)},r))},createTemporary:function(t,e,i){return this.create(t,e,i).stopListening()}})},{}],19:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e,i,o){var r=this;e||(e={}),this._tag=t,this._attributeMap=e,this._selector=i,this._invertedAttributeMap={},n.each(e,function(t,e){r._invertedAttributeMap[r._getDataKey(t)]=e}),o||(o={});var s={};n.each(e,function(t,e){var i=r._getDataKey(t);i?o[i]&&(s[e]=o[i]):s[e]=t}),this._attributes=s},n.extend(e.exports.prototype,{getTag:function(){return this._tag},getAttributes:function(){return this._attributes},getAttributeNames:function(){return n.keys(this._attributeMap)},setAttribute:function(t,e){return this._attributes[this.getAttributeName(t)]=e,this},getAttribute:function(t){return this._attributes[this.getAttributeName(t)]},getAttributeName:function(t){var e=this._getDataKey(t);return e&&this._invertedAttributeMap[e]&&(t=this._invertedAttributeMap[e]),t},renderOpeningTag:function(){var t="<"+this.getTag();return n.each(this.getAttributes(),function(e,i){t+=" "+i+'="'+e+'"'}),t+">"},renderClosingTag:function(){return"</"+this.getTag()+">"},getSelector:function(){var t=this.getAttributes(),e="";if(this._selector)e=this._selector;else if(t.class){var i=t.class.split(" ");n.each(i,function(t){e+="."+t},this)}else e=this.getTag();return e},_getDataKey:function(t){var e=/^<([a-z\-]+)>$/,i=e.exec(t);return!(!i||!i[1])&&i[1]}})},{}],20:[function(t,e,i){"use strict";var n=window._,o=t("./Element");e.exports=function(t){this._elements=t,n.each(this._elements,function(t){t.attributes||(t.attributes={})})},n.extend(e.exports.prototype,{getTemplate:function(t){return this.create(t)},create:function(t,e){var i=this._elements[t];if(!i)throw new Error("Invalid element type.");return new o(i.tag,i.attributes,i.selector,e)}})},{"./Element":19}],21:[function(t,e,i){"use strict";var n=window.Backbone,o=t("../Collections/EditBufferItemCollection");e.exports=n.Model.extend({type:"Context",defaults:{ownerId:"",fieldId:"",schemaId:"",settings:{}},constructor:function(t,e){this.editBuffer=new o([],{contextId:t.id}),n.Model.apply(this,[t,e])},set:function(t,e){t.editBufferItems&&(this.editBuffer.add(t.editBufferItems,{merge:!0}),delete t.editBufferItems);var i=this.get("id"),o=t.id;if(o&&i&&o!=i){var r=this.collection;r&&(r.remove(this,{silent:!0}),this.attributes.id=this.id=o,r.add(this,{silent:!0}),this.attributes.id=this.id=i)}n.Model.prototype.set.call(this,t,e)},getSetting:function(t){return this.get("settings")[t]}})},{"../Collections/EditBufferItemCollection":6}],22:[function(t,e,i){"use strict";var n=window.Backbone;e.exports=n.Model.extend({type:"EditBufferItem",defaults:{contextId:"",insert:!1,markup:"...",type:"",fields:{}}})},{}],23:[function(t,e,i){"use strict";var n=window.Backbone;e.exports=n.Model.extend({type:"Editor",initialize:function(t,e){this.widgetFactory=e.widgetFactory,this.viewFactory=e.viewFactory,this.widgetStore=e.widgetStore,this.editBufferMediator=e.editBufferMediator,this.context=e.context,this.contextResolver=e.contextResolver,this.listenTo(this.context,"change:id",this._updateContextId)},destroy:function(){this.stopListening(),this.widgetStore.cleanup(),this.editBufferMediator.cleanup()},_updateContextId:function(t){this.set({id:t.get("id")})}})},{}],24:[function(t,e,i){"use strict";var n=window.Backbone;e.exports=n.Model.extend({type:"Schema",defaults:{allowed:{}},isAllowed:function(t){return!!this.get("allowed")[t]}})},{}],25:[function(t,e,i){"use strict";var n=window._,o=window.Backbone,r={READY:1,DESTROYED_WIDGET:2,DESTROYED_REFS:4,DESTROYED:6};e.exports=o.Model.extend({type:"Widget",defaults:{contextId:"",itemId:0,itemContextId:"",markup:"",edits:{},duplicating:!1,state:r.READY},constructor:function(t,e){this.widget=e.widget,this._editBufferItemRefFactory=e.editBufferItemRefFactory,this._contextResolver=e.contextResolver,o.Model.apply(this,[t,e])},set:function(t,e){return this._filterAttributes(t),o.Model.prototype.set.call(this,t,e)},edit:function(){return this.editBufferItemRef.edit(this.get("edits")),this},duplicate:function(){return this.set({duplicating:!0}),this.editBufferItemRef.duplicate(this.get("id"),this.get("edits")),this},destroy:function(t){return this.hasState(r.DESTROYED)||(this.trigger("destroy",this,this.collection,t),this.setState(r.DESTROYED)),this},setState:function(t){return this.set({state:this.get("state")|t})},hasState:function(t){return(this.get("state")&t)===t},_filterAttributes:function(t){(this._refreshEditBufferItemRef(t)||t.edits)&&this._setupListeners(t)},_refreshEditBufferItemRef:function(t){var e=!1,i=this.get("itemContextId"),n=this.get("contextId"),o=this.get("itemId"),r=t.itemContextId?t.itemContextId:i,s=t.contextId?t.contextId:n,a=t.itemId?t.itemId:o;return r==i&&s==n&&a==o||(this.editBufferItemRef=this._editBufferItemRefFactory.createFromIds(a,r,s),e=!0,t.markup=this.editBufferItemRef.editBufferItem.get("markup")),e},_setupListeners:function(t){return this.stopListening().listenTo(this.editBufferItemRef.editBufferItem,"change:markup",this._readFromBufferItem).listenTo(this.editBufferItemRef.sourceContext,"change:id",this._updateContext).listenTo(this.editBufferItemRef.targetContext,"change:id",this._updateContext),n.each(t.edits,function(t,e){var i=this._contextResolver.get(e);this.listenTo(i,"change:id",this._updateContext)},this),this},_readFromBufferItem:function(t){this.set({markup:t.get("markup")})},_updateContext:function(t){var e=t.previous("id"),i=t.get("id"),o={};this.get("itemContextId")==e&&(o.itemContextId=i),this.get("contextId")==e&&(o.contextId=i);var r=this.get("edits");r[e]&&(o.edits={},n.each(r,function(t,n){n==e?o.edits[i]=t.replace(e,i):o.edits[n]=t},this)),this.set(o),this.trigger("rebase",this,e,i)}}),e.exports.State=r},{}],26:[function(t,e,i){"use strict";var n=window._,o=window.Backbone,r=t("../unimplemented");e.exports=function(){},n.extend(e.exports.prototype,o.Events,{insertEmbedCode:function(t){r(t)},destroyWidget:function(t){r(t)},attachInlineEditing:function(t,e,i){r(t,e,i)},getInlineEdit:function(t,e,i){return r(t,e,i)},getRootEl:function(){return r()},cleanup:function(){this.stopListening()}}),e.exports.extend=o.Model.extend},{"../unimplemented":38}],27:[function(t,e,i){"use strict";var n=window._,o=window.Backbone,r=t("../unimplemented");e.exports=function(){},n.extend(e.exports.prototype,{send:function(t,e,i){r(t,e,i)}}),e.exports.extend=o.Model.extend},{"../unimplemented":38}],28:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e){this._protocol=t,this._resolver=e},n.extend(e.exports.prototype,{dispatch:function(t,e){this._protocol.send(t,e,this._resolver)}})},{}],29:[function(t,e,i){"use strict";var n=window._;e.exports=function(){this._collections={}},n.extend(e.exports.prototype,{addCollection:function(t,e){this._collections[t]=e},resolve:function(t){n.each(t,function(t){this._collections[t.type]&&this._updateModel(t,this._collections[t.type])},this)},_updateModel:function(t,e){var i=e;"function"==typeof e&&(i=e(t.attributes));var n=i.get(t.id);n?n.set(t.attributes):(t.attributes.id||(t.attributes.id=t.id),i.add(t.attributes))}})},{}],30:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,e,i){var o=t.create("widget-display"),r=t.create("toolbar"),s=t.create("toolbar-item"),a=t.create("widget-command"),d=o.renderOpeningTag()+e+r.renderOpeningTag();return n.each(i,function(t,e){d+=s.renderOpeningTag()+a.setAttribute("<command>",e).renderOpeningTag()+t.title+a.renderClosingTag()+s.renderClosingTag()}),d+=r.renderClosingTag()+o.renderClosingTag()}},{}],31:[function(t,e,i){"use strict";var n=window._;e.exports=function(t,i,o){var r="";return i&&n.each(i,function(i){var n,s=t.create(i.type,i);"field"==i.type&&(i.context?(n=o[i.context],s.setAttribute("<editable>","true")):s.setAttribute("<editable>","false")),r+=s.renderOpeningTag(),r+=n||e.exports(t,i.children,o),r+=s.renderClosingTag()}),r}},{}],32:[function(t,e,i){"use strict";var n=window.Backbone;e.exports=n.View.extend({initialize:function(t,e){if(!e.elementFactory)throw new Error("Required elementFactory option missing.");this._elementFactory=e.elementFactory,this.listenTo(this.model,"change:id",this.render),this.listenTo(this.model,"destroy",this.stopListening),this.render()},render:function(){var t=this._elementFactory.getTemplate("field");this.$el.attr(t.getAttributeName("<context>"),this.model.get("context")),this.trigger("DOMMutate",this,this.$el)}})},{}],33:[function(t,e,i){"use strict";var n=window._,o=window.Backbone,r=o.$,s=t("./WidgetView"),a=t("../unimplemented");e.exports=s.extend({processingIndicator:"...",actions:{edit:{title:"Edit",callback:function(){this.save().edit()}},remove:{title:"Remove",callback:function(){this.remove()}}},initialize:function(t){s.prototype.initialize.call(this,t),t.processingIndicator&&(this.processingIndicator=t.processingIndicator);var e=this._elementFactory.getTemplate("widget-command");this.commandSelector=e.getSelector(),this.commandAttribute=e.getAttributeName("<command>"),this.listenTo(this.model,"change",this._changeHandler),this.listenTo(this.model,"rebase",this._rebase),this._stale={}},template:function(t,e,i){a(t,e,i)},render:function(t){switch(this._find(this.commandSelector).off(),t){case"duplicating":this._renderDuplicating();break;case"container":this._renderContainer();break;case"attributes":this._renderAttributes();break;default:this._renderAll()}return this._cleanupStaleEditables(),this.trigger("DOMRender",this,this.$el),this.trigger("DOMMutate",this,this.$el),this},edit:function(){this.model.edit()},remove:function(){if(this.stopListening(),this.model){this.trigger("DOMRemove",this,this.$el),this._cleanupStaleEditables(!0);var t=this.model;this.model=null,t.destroy()}return this},stopListening:function(){return this._find(this.commandSelector).off(),s.prototype.stopListening.apply(this,arguments)},isEditorViewRendered:function(){return"editor"==this.$el.attr(this.viewModeAttribute)},_renderDuplicating:function(){return this.trigger("DOMRemove",this,this.$el.children()),this.$el.html(this.template(this._elementFactory,this.processingIndicator,this.actions)),this},_renderContainer:function(){var t={};this._inlineElementVisitor(function(e,i){t[i]=e.contents()});var e=r("<div></div>"),i=r("<div></div>"),n=this.$el.children();return this.$el.append(e),this.$el.append(i),e.append(n),i.html(this.template(this._elementFactory,this.model.get("markup"),this.actions)),this._find(this.inlineEditorSelector,e).attr(this.inlineContextAttribute,""),this._inlineElementVisitor(function(e,i,n){this._attachInlineEditing(e,i,n),t[i]&&e.html("").append(t[i])},i),this.$el.append(i.children()),this.trigger("DOMRemove",this,e),e.remove(),i.remove(),this._renderAttributes()._renderCommands()},_renderAll:function(){this.trigger("DOMRemove",this,this.$el.children()),this.$el.html(this.template(this._elementFactory,this.model.get("markup"),this.actions));var t=this.model.get("edits");return this._inlineElementVisitor(function(e,i,n){t[i]&&e.html(t[i]?t[i]:""),this._attachInlineEditing(e,i,n)}),this._renderAttributes()._renderCommands()},_renderAttributes:function(){var t=this._elementFactory.create("widget",{context:this.model.get("contextId"),uuid:this.model.get("itemId"),viewmode:"editor"});return n.each(t.getAttributes(),function(t,e){this.$el.attr(e,t)},this),this.trigger("DOMMutate",this,this.$el),this},_renderCommands:function(){var t=this;return this._find(this.commandSelector).on("click",function(){var e=r(this).attr(t.commandAttribute);t.actions[e].callback.call(t)}),this},_changeHandler:function(){return this.model.previous("duplicating")?this.render():this.model.get("duplicating")?this.render("duplicating"):this.model.hasChanged("markup")?this.render("container"):(this.model.hasChanged("itemId")||this.model.hasChanged("contextId"))&&this.render("attributes"),this},_rebase:function(t,e,i){return t||(t=this.model),this._inlineElementVisitor(function(t,n){n==e&&(t.attr(this.inlineContextAttribute,i),this.trigger("DOMMutate",this,t))}),this._stale[e]=!0,this},_cleanupStaleEditables:function(t){return t?this._inlineElementVisitor(function(t,e,i){this._adapter.detachInlineEditing(this,e,i)}):n.each(this._stale,function(t,e){var i=this._inlineElementSelector(e);this._adapter.detachInlineEditing(this,e,i)},this),this._stale={},this},_attachInlineEditing:function(t,e,i){var n=this._contextResolver.get(e);t.attr(this._dataAttribute,JSON.stringify(n.toJSON())),this._adapter.attachInlineEditing(this,e,i)}})},{"../unimplemented":38,"./WidgetView":35}],34:[function(t,e,i){"use strict";var n=window._,o=t("./WidgetView"),r=t("../unimplemented");e.exports=o.extend({initialize:function(t){o.prototype.initialize.call(this,t),this.attributeWhitelist=n.invert(this.widgetTemplate.getAttributeNames()),delete this.attributeWhitelist[this.widgetTemplate.getAttributeName("<viewmode>")]},template:function(t,e,i){r(t,e,i)},render:function(){var t=this,e=this.model.editBufferItemRef.editBufferItem.get("fields"),i=this.model.get("edits");return this.$el.html(this.template(this._elementFactory,e,i)),n.each(this.el.attributes,function(e){n.isUndefined(t.attributeWhitelist[e.name])&&t.$el.removeAttr(e.name)}),this}})},{"../unimplemented":38,"./WidgetView":35}],35:[function(t,e,i){"use strict";var n=window.Backbone,o=n.$,r=t("../unimplemented");e.exports=n.View.extend({_dataAttribute:"data-widget-binder-internal",initialize:function(t){if(!t.adapter)throw new Error("Required adapter option missing.");if(!t.elementFactory)throw new Error("Required elementFactory option missing.");if(!t.template)throw new Error("Required template option missing.");this._adapter=t.adapter,this._elementFactory=t.elementFactory,this._contextResolver=t.contextResolver,this.template=t.template,this.widgetTemplate=this._elementFactory.getTemplate("widget"),this.fieldTemplate=this._elementFactory.getTemplate("field"),this.widgetCommandTemplate=this._elementFactory.getTemplate("widget-command"),this.widgetSelector=this.widgetTemplate.getSelector(),this.viewModeAttribute=this.widgetTemplate.getAttributeName("<viewmode>"),this.inlineContextAttribute=this.fieldTemplate.getAttributeName("<context>"),this.inlineEditorSelector=this.fieldTemplate.getSelector()},template:function(){r()},render:function(){r()},save:function(){if(!this.model.get("duplicating")){var t={};this._inlineElementVisitor(function(e,i,n){t[i]=this._adapter.getInlineEdit(this,i,n);var o=e.attr(this._dataAttribute);o&&(o=JSON.parse(o),this._contextResolver.get(o.id).set(o))}),this.model.set({edits:t},{silent:!0})}return this},remove:function(){return this},_inlineElementSelector:function(t){return"["+this.inlineContextAttribute+'="'+t+'"]'},_inlineElementVisitor:function(t,e){e||(e=this.$el);var i=this;return this._find(this.inlineEditorSelector,e).each(function(){var e=o(this).attr(i.inlineContextAttribute),n=i._inlineElementSelector(e);t.call(i,o(this),e,n)}),this},_find:function(t,e){var i=this,n=o([]);return e||(e=this.$el),e.children().each(function(){var e=o(this);e.is(t)&&(n=n.add(e)),e.is(i.widgetSelector)||(n=n.add(i._find(t,e)))}),n}})},{"../unimplemented":38}],36:[function(t,e,i){"use strict";e.exports={name:"default",servicePrototypes:{Binder:t("./Binder"),CommandEmitter:t("./Editor/Command/CommandEmitter"),ContextCollection:t("./Collections/ContextCollection"),ContextListener:t("./Context/ContextListener"),ContextResolver:t("./Context/ContextResolver"),EditBufferItemRefFactory:t("./EditBuffer/EditBufferItemRefFactory"),EditBufferMediator:t("./EditBuffer/EditBufferMediator"),EditorCollection:t("./Collections/EditorCollection"),ElementFactory:t("./Element/ElementFactory"),SchemaCollection:t("./Collections/SchemaCollection"),SyncActionDispatcher:t("./SyncAction/SyncActionDispatcher"),SyncActionResolver:t("./SyncAction/SyncActionResolver"),WidgetFactory:t("./Editor/Widget/WidgetFactory"),WidgetStore:t("./Editor/Widget/WidgetStore"),WidgetViewFactory:t("./Editor/Widget/WidgetViewFactory"),EditorView:t("./Views/EditorView")},views:{editor:{prototype:t("./Views/WidgetEditorView"),options:{template:t("./Templates/WidgetEditorViewTemplate")}},export:{prototype:t("./Views/WidgetMementoView"),options:{template:t("./Templates/WidgetMementoViewTemplate")}}},plugins:{adapter:{},protocol:{}},elements:{widget:{tag:"div",attributes:{"data-uuid":"<uuid>","data-context-hint":"<context>","data-viewmode":"<viewmode>",class:"widget-binder-widget"},selector:".widget-binder-widget[data-context-hint]"},field:{tag:"div",attributes:{"data-field-name":"<name>","data-context":"<context>","data-mutable":"<editable>",class:"widget-binder-field"},
selector:'.widget-binder-field[data-mutable="true"]'},"widget-display":{tag:"div",attributes:{class:"widget-binder-widget__display"}},toolbar:{tag:"ul",attributes:{class:"widget-binder-toolbox"}},"toolbar-item":{tag:"li",attributes:{class:"widget-binder-toolbox__item"}},"widget-command":{tag:"a",attributes:{class:"widget-binder-command","data-command":"<command>",href:"#"}}},data:{context:{},schema:{}}}},{"./Binder":4,"./Collections/ContextCollection":5,"./Collections/EditorCollection":7,"./Collections/SchemaCollection":8,"./Context/ContextListener":10,"./Context/ContextResolver":11,"./EditBuffer/EditBufferItemRefFactory":13,"./EditBuffer/EditBufferMediator":14,"./Editor/Command/CommandEmitter":15,"./Editor/Widget/WidgetFactory":16,"./Editor/Widget/WidgetStore":17,"./Editor/Widget/WidgetViewFactory":18,"./Element/ElementFactory":20,"./SyncAction/SyncActionDispatcher":28,"./SyncAction/SyncActionResolver":29,"./Templates/WidgetEditorViewTemplate":30,"./Templates/WidgetMementoViewTemplate":31,"./Views/EditorView":32,"./Views/WidgetEditorView":33,"./Views/WidgetMementoView":34}],37:[function(t,e,i){"use strict";var n=window._,o=window.jQuery;e.exports=function(t){t||(t={}),this._initialize(t)},n.extend(e.exports,{defaults:t("./config"),PluginInterface:{EditorAdapter:t("./Plugins/EditorAdapter"),SyncProtocol:t("./Plugins/SyncProtocol")},create:function(t){return new e.exports(t)},config:function(){var t=e.exports.defaults,i={};return i.servicePrototypes={},n.defaults(i.servicePrototypes,t.servicePrototypes),i.views={},n.each(t.views,function(t,e){i.views[e]={options:{}},n.defaults(i.views[e].options,t.options),n.defaults(i.views[e],t)}),i.plugins={},n.defaults(i.plugins,t.plugins),o.extend(!0,i.elements,t.elements),i.data={},n.defaults(i.data,t.data),n.defaults(i,t),i}}),n.extend(e.exports.prototype,{getElementFactory:function(){return this._elementFactory},getContexts:function(){return this._contextCollection},getSchema:function(){return this._schemaCollection},getEditors:function(){return this._editorCollection},getSyncActionDispatcher:function(){return this._syncActionDispatcher},getSyncActionResolver:function(){return this._syncActionResolver},open:function(t){t.addClass("widget-binder-open");var e,i=this._createContextResolver().resolveTargetContext(t),n=i?i.get("id"):null;if(n){if(this._editorCollection.get(n))throw new Error("Existing binder already open for this editor instance.");var o=this._createContextResolver(i),r=this._createService("CommandEmitter",this._syncActionDispatcher,o),s=this._createService("EditBufferItemRefFactory",o,r),a=this._createService("ContextListener");a.addContext(i);var d=this._globalSettings.plugins.adapter;"function"==typeof d.create&&(d=d.create.apply(d,arguments));var c=this._createService("WidgetViewFactory",o,this._elementFactory,d);for(var l in this._globalSettings.views)c.register(l,this._globalSettings.views[l]);var u=this._elementFactory.getTemplate("widget").getAttributeName("<uuid>"),h=this._createService("WidgetFactory",o,s,u),f=this._createService("WidgetStore",d),g=this._createService("EditBufferMediator",s,this._elementFactory,a,d,o);e=new this._globalSettings.servicePrototypes.EditorCollection.prototype.model({id:n},{widgetFactory:h,viewFactory:c,widgetStore:f,editBufferMediator:g,context:i,contextResolver:o});var m=this._createService("EditorView",{model:e,el:t[0]},{elementFactory:this._elementFactory});return this._editorCollection.set(e),this._createService("Binder",m)}},_initialize:function(t){this._globalSettings=n.defaults(t,e.exports.defaults);var i=this._globalSettings.plugins.protocol;"function"==typeof i.create&&(i=i.create.apply(i,arguments)),this._syncActionResolver=this._createService("SyncActionResolver"),this._syncActionDispatcher=this._createService("SyncActionDispatcher",i,this._syncActionResolver);var o=this._createService("EditorCollection"),r=this._createService("ContextCollection"),s=this._createService("SchemaCollection",[],{contextCollection:r,dispatcher:this._syncActionDispatcher});this._editorCollection=o,this._contextCollection=r,this._schemaCollection=s,this._syncActionResolver.addCollection("context",this._contextCollection),this._syncActionResolver.addCollection("schema",this._schemaCollection),this._syncActionResolver.addCollection("editBufferItem",function(t){return r.get(t.contextId).editBuffer}),this._syncActionResolver.addCollection("widget",function(t){var e=o.get(t.editorContextId).widgetStore;return{get:function(t){return e.get(t).model},add:function(t){return e.add(t)}}}),this._elementFactory=this._createService("ElementFactory",this._globalSettings.elements),t.data&&this._syncActionResolver.resolve(t.data)},_createContextResolver:function(t){var e=this._elementFactory.getTemplate("widget").getAttributeName("<context>"),i=this._elementFactory.getTemplate("field").getAttributeName("<context>");return this._createService("ContextResolver",this._contextCollection,e,i,t)},_createService:function(t){for(var e=[],i=1;i<arguments.length;++i)e.push(arguments[i]);var n=this._globalSettings.servicePrototypes[t];switch(e.length){case 0:return new n;case 1:return new n(e[0]);case 2:return new n(e[0],e[1]);case 3:return new n(e[0],e[1],e[2]);case 4:return new n(e[0],e[1],e[2],e[3]);case 5:return new n(e[0],e[1],e[2],e[3],e[4]);default:throw new Error("Really, you need to inject more than five services? Consider factoring "+t+" into separate classes.")}}})},{"./Plugins/EditorAdapter":26,"./Plugins/SyncProtocol":27,"./config":36}],38:[function(t,e,i){"use strict";e.exports=function(){throw new Error("Unimplemented method.")}},{}]},{},[3]);